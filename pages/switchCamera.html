<!DOCTYPE html>
<html>
	<head>
		<link href="../assets/styles/normalize.css"  rel="stylesheet" type="text/css"/>
		<script src="../assets/js/getScreenId.js"></script>
		<script src="../assets/js/jquery-3.1.1.min.js"></script>
		<title>Screen capture</title>
		<style>
			.main {
				width: 100%;
				height: 100vh;
				background-color: #4caf50;
			}
		</style>
	</head>
	<body class="main">
		<h3>Screen capture test</h3>
		<button onclick="handleSwitchCamera()">Switch camera</button>
		<button onclick="handleStopCamera()">Stop camera</button>
		<video id="video" width="500" autoplay>
			Your browser is not support video tag
		</video>
		<script>
            var videoTag = document.getElementById('video');
            var currentCamera = 'front';

            function removeStream(mediaStream) {
              if (!mediaStream) {
                return;
              }
              // Stop stream
              if (mediaStream.stop) {
                mediaStream.stop();
              } else {
                mediaStream.getTracks().forEach(function (track) {
                  track.stop();
                })
              }
            }

            function handleStopCamera() {
              removeStream(window.mediaStream);
            }

            function handleSwitchCamera() {
                console.log('HandleSwitchCamera');
                if ( currentCamera === 'front' ) {
                  // Switch to back
                  loadBackCamera();
                  currentCamera = 'back';
                } else {
                  loadFrontCamera();
                  currentCamera = 'front';
                }
            }

            function loadBackCamera() {
              console.log('loadBackCamera');
              removeStream(window.mediaStream);
              navigator.mediaDevices.getUserMedia({
                video: {
                  facingMode: 'environment'
                },
                audio: true
              }).then( ( stream, error ) => {
                if ( error ) {
                  console.log( 'error' );
                  console.log( error );
                  return;
                }
                window.mediaStream = stream;

                videoTag.srcObject = stream;
              });
            }

            function loadFrontCamera() {
              console.log('loadFrontCamera');
              removeStream(window.mediaStream);
              navigator.mediaDevices.getUserMedia({video: true, audio: true}).then( ( stream, error ) => {
                if ( error ) {
                  console.log( 'error' );
                  console.log( error );
                  return;
                }
                window.mediaStream = stream;

                videoTag.srcObject = stream;
              });
            }
            loadFrontCamera();
		</script>
	</body>
</html>
